!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Motion={})}(this,(function(t){"use strict";function e(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}function n(t){let e;return()=>(void 0===e&&(e=t()),e)}const i=t=>t,a=(t,e,n)=>{const i=e-t;return 0===i?1:(n-t)/i},r=t=>1e3*t,s=t=>t/1e3,o=n((()=>void 0!==window.ScrollTimeline));class l{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map((t=>t.finished)))}getAll(t){return this.animations[0][t]}setAll(t,e){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=e}attachTimeline(t,e){const n=this.animations.map((n=>o()&&n.attachTimeline?n.attachTimeline(t):"function"==typeof e?e(n):void 0));return()=>{n.forEach(((t,e)=>{t&&t(),this.animations[e].stop()}))}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let e=0;e<this.animations.length;e++)t=Math.max(t,this.animations[e].duration);return t}runAll(t){this.animations.forEach((e=>e[t]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class u extends l{then(t,e){return this.finished.finally(t).then((()=>{}))}}const c=t=>t.startsWith("--"),h=(t,e,n)=>{c(e)?t.style.setProperty(e,n):t.style[e]=n},f=(t,e)=>c(e)?t.style.getPropertyValue(e):t.style[e],m=t=>null!==t;const d=n((()=>{try{document.createElement("div").animate({opacity:[1]})}catch(t){return!1}return!0})),p=new Set(["borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderRadius","radius","borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius","width","maxWidth","height","maxHeight","top","right","bottom","left","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","margin","marginTop","marginRight","marginBottom","marginLeft","backgroundPositionX","backgroundPositionY"]);const y={value:null,addProjectionMetrics:null},g={};function A(t,e){const i=n(t);return()=>g[e]??i()}const b=A((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(t){return!1}return!0}),"linearEasing"),v=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,T={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:v([0,.65,.55,1]),circOut:v([.55,0,1,.45]),backIn:v([.31,.01,.66,-.59]),backOut:v([.33,1.53,.69,.99])};function w(t,e){return t?"function"==typeof t&&b()?((t,e,n=10)=>{let i="";const a=Math.max(Math.round(e/n),2);for(let e=0;e<a;e++)i+=t(e/(a-1))+", ";return`linear(${i.substring(0,i.length-2)})`})(t,e):(t=>Array.isArray(t)&&"number"==typeof t[0])(t)?v(t):Array.isArray(t)?t.map((t=>w(t,e)||T.easeOut)):T[t]:void 0}function x(t){return"function"==typeof t&&"applyToOptions"in t}const M=new WeakMap;class k{constructor(t){if("animation"in t)return void(this.animation=t.animation);const{element:e,name:n,keyframes:i,pseudoElement:a,allowFlatten:r=!1}=t;let{transition:s}=t;this.allowFlatten=r;const o=function(t){const e=M.get(t)||new Map;return M.set(t,e),e}(e),l=((t,e)=>`${t}:${e}`)(n,a||""),u=o.get(l);u&&u.stop();const c=function(t,e,n,i){Array.isArray(n)||(n=[n]);for(let a=0;a<n.length;a++)null===n[a]&&(n[a]=0!==a||i?n[a-1]:f(t,e)),"number"==typeof n[a]&&p.has(e)&&(n[a]=n[a]+"px");return!i&&!d()&&n.length<2&&n.unshift(f(t,e)),n}(e,n,i,a);s.type,s=function({type:t,...e}){return x(t)?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}(s),this.animation=function(t,e,n,{delay:i=0,duration:a=300,repeat:r=0,repeatType:s="loop",ease:o="easeInOut",times:l}={},u){const c={[e]:n};l&&(c.offset=l);const h=w(o,a);return Array.isArray(h)&&(c.easing=h),t.animate(c,{delay:i,duration:a,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:"reverse"===s?"alternate":"normal",pseudoElement:u})}(e,n,c,s,a),!1===s.autoplay&&this.animation.pause(),this.removeAnimation=()=>o.delete(l),this.animation.onfinish=()=>{a?this.commitStyles():h(e,n,function(t,{repeat:e,repeatType:n="loop"},i){const a=t.filter(m),r=e&&"loop"!==n&&e%2==1?0:a.length-1;return r&&void 0!==i?i:a[r]}(c,s)),this.cancel()},o.set(l,this)}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.finish()}cancel(){try{this.animation.cancel()}catch(t){}this.removeAnimation()}stop(){const{state:t}=this;"idle"!==t&&"finished"!==t&&(this.commitStyles(),this.cancel())}commitStyles(){this.animation.commitStyles?.()}get duration(){console.log(this.animation.effect?.getComputedTiming());const t=this.animation.effect?.getComputedTiming().duration||0;return s(Number(t))}get time(){return s(Number(this.animation.currentTime)||0)}set time(t){this.animation.currentTime=r(t)}get speed(){return this.animation.playbackRate}set speed(t){this.animation.playbackRate=t}get state(){return this.animation.playState}get startTime(){return Number(this.animation.startTime)}get finished(){return this.animation.finished}flatten(){this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"})}attachTimeline(t){return this.animation.timeline=t,this.animation.onfinish=null,i}then(t,e){return this.finished.then(t).catch(e)}}const R=2e4;function O(t,e=100,n){const i=n({...t,keyframes:[0,e]}),a=Math.min(function(t){let e=0,n=t.next(e);for(;!n.done&&e<R;)e+=50,n=t.next(e);return e>=R?1/0:e}(i),R);return{type:"keyframes",ease:t=>i.next(a*t).value/e,duration:s(a)}}const S=["read","resolveKeyframes","update","preRender","render","postRender"];function E(t,e){let n=!1,i=!0;const a={delta:0,timestamp:0,isProcessing:!1},r=()=>n=!0,s=S.reduce(((t,n)=>(t[n]=function(t,e){let n=new Set,i=new Set,a=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function u(e){s.has(e)&&(c.schedule(e),t()),l++,e(o)}const c={schedule:(t,e=!1,r=!1)=>{const o=r&&a?n:i;return e&&s.add(t),o.has(t)||o.add(t),t},cancel:t=>{i.delete(t),s.delete(t)},process:t=>{o=t,a?r=!0:(a=!0,[n,i]=[i,n],n.forEach(u),e&&y.value&&y.value.frameloop[e].push(l),l=0,n.clear(),a=!1,r&&(r=!1,c.process(t)))}};return c}(r,e?n:void 0),t)),{}),{read:o,resolveKeyframes:l,update:u,preRender:c,render:h,postRender:f}=s,m=()=>{const r=performance.now();n=!1,a.delta=i?1e3/60:Math.max(Math.min(r-a.timestamp,40),1),a.timestamp=r,a.isProcessing=!0,o.process(a),l.process(a),u.process(a),c.process(a),h.process(a),f.process(a),a.isProcessing=!1,n&&e&&(i=!1,t(m))};return{schedule:S.reduce(((e,r)=>{const o=s[r];return e[r]=(e,r=!1,s=!1)=>(n||(n=!0,i=!0,a.isProcessing||t(m)),o.schedule(e,r,s)),e}),{}),cancel:t=>{for(let e=0;e<S.length;e++)s[S[e]].cancel(t)},state:a,steps:s}}const{schedule:P,cancel:W,state:B,steps:F}=E("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:i,!0);function $(t,e,n){if(t instanceof EventTarget)return[t];if("string"==typeof t){let i=document;e&&(i=e.current);const a=n?.[t]??i.querySelectorAll(t);return a?Array.from(a):[]}return Array.from(t)}S.reduce(((t,e)=>(t[e]=t=>W(t),t)),{});function I(t,e){return n=t,Array.isArray(n)&&"number"!=typeof n[0]?t[((t,e,n)=>{const i=e-t;return((n-t)%i+i)%i+t})(0,t.length,e)]:t;var n}const L=(t,e,n)=>t+(e-t)*n;function q(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=a(0,e,i);t.push(L(n,1,r))}}function N(t){const e=[0];return q(e,t.length-1),e}function j(t,e,n,i){return"string"==typeof t&&function(t){return"object"==typeof t&&!Array.isArray(t)}(e)?$(t,n,i):t instanceof NodeList?Array.from(t):Array.isArray(t)?t:[t]}function C(t,e,n){return t*(e+1)}function K(t,e,n,i){return"number"==typeof e?e:e.startsWith("-")||e.startsWith("+")?Math.max(0,t+parseFloat(e)):"<"===e?n:i.get(e)??t}function V(t,n,i,a,r,s){!function(t,n,i){for(let a=0;a<t.length;a++){const r=t[a];r.at>n&&r.at<i&&(e(t,r),a--)}}(t,r,s);for(let e=0;e<n.length;e++)t.push({value:n[e],at:L(r,s,a[e]),easing:I(i,e)})}function z(t,e){for(let n=0;n<t.length;n++)t[n]=t[n]/(e+1)}function D(t,e){return t.at===e.at?null===t.value?1:null===e.value?-1:0:t.at-e.at}function H(t,e){return!e.has(t)&&e.set(t,{}),e.get(t)}function X(t,e){return e[t]||(e[t]=[]),e[t]}function Y(t){return Array.isArray(t)?t:[t]}function G(t,e){return t&&t[e]?{...t,...t[e]}:{...t}}const J=t=>"number"==typeof t,Q=t=>t.every(J);function U(t,e,n,i){const a=$(t,i),s=a.length,o=[];for(let t=0;t<s;t++){const i=a[t],c={...n};"function"==typeof c.delay&&(c.delay=c.delay(t,s));for(const t in e){const n=e[t],a={...(l=c,u=t,l?.[u]??l?.default??l)};a.duration&&(a.duration=r(a.duration)),a.delay&&(a.delay=r(a.delay)),o.push(new k({element:i,name:t,keyframes:n,transition:a,allowFlatten:!c.type&&!c.ease}))}}var l,u;return o}const Z=(t=>function(e,n,i){return new u(U(e,n,i,t))})();t.animate=Z,t.animateSequence=function(t,e){const n=[];return function(t,{defaultTransition:e={},...n}={},i,s){const o=e.duration||.3,l=new Map,u=new Map,c={},h=new Map;let f=0,m=0,d=0;for(let n=0;n<t.length;n++){const a=t[n];if("string"==typeof a){h.set(a,m);continue}if(!Array.isArray(a)){h.set(a.name,K(m,a.at,f,h));continue}let[l,y,g={}]=a;void 0!==g.at&&(m=K(m,g.at,f,h));let A=0;const b=(t,n,i,a=0,l=0)=>{const u=Y(t),{delay:c=0,times:h=N(u),type:f="keyframes",repeat:p,repeatType:y,repeatDelay:g=0,...b}=n;let{ease:v=e.ease||"easeOut",duration:T}=n;const w="function"==typeof c?c(a,l):c,M=u.length,k=x(f)?f:s?.[f];if(M<=2&&k){let t=100;if(2===M&&Q(u)){const e=u[1]-u[0];t=Math.abs(e)}const e={...b};void 0!==T&&(e.duration=r(T));const n=O(e,t,k);v=n.ease,T=n.duration}T??(T=o);const R=m+w;1===h.length&&0===h[0]&&(h[1]=1);const S=h.length-u.length;if(S>0&&q(h,S),1===u.length&&u.unshift(null),p){T=C(T,p);const t=[...u],e=[...h];v=Array.isArray(v)?[...v]:[v];const n=[...v];for(let i=0;i<p;i++){u.push(...t);for(let a=0;a<t.length;a++)h.push(e[a]+(i+1)),v.push(0===a?"linear":I(n,a-1))}z(h,p)}const E=R+T;V(i,u,v,h,R,E),A=Math.max(w+T,A),d=Math.max(E,d)};if(p=l,Boolean(p&&p.getVelocity))b(y,g,X("default",H(l,u)));else{const t=j(l,y,i,c),e=t.length;for(let n=0;n<e;n++){const i=H(t[n],u);for(const t in y)b(y[t],G(g,t),X(t,i),n,e)}}f=m,m+=A}var p;return u.forEach(((t,i)=>{for(const r in t){const s=t[r];s.sort(D);const o=[],u=[],c=[];for(let t=0;t<s.length;t++){const{at:e,value:n,easing:i}=s[t];o.push(n),u.push(a(0,d,e)),c.push(i||"easeOut")}0!==u[0]&&(u.unshift(0),o.unshift(o[0]),c.unshift("easeInOut")),1!==u[u.length-1]&&(u.push(1),o.push(null)),l.has(i)||l.set(i,{keyframes:{},transition:{}});const h=l.get(i);h.keyframes[r]=o,h.transition[r]={...e,duration:d,ease:c,times:u,...n}}})),l}(t,e).forEach((({keyframes:t,transition:e},i)=>{n.push(...U(i,t,e))})),new u(n)}}));
